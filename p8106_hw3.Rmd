---
title: "p8106 hw3"
author: "Nathalie Fadel"
date: "4/8/2019"
output: github_document
---

###Import & view data
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(caret)
library(ISLR)
library(AppliedPredictiveModeling)
library(glmnet)
library(e1071)
library(pROC)

data("Weekly")

summary(Weekly)

```

###Plots
```{r}
pairs(Weekly) 

transparentTheme(trans = .4)
featurePlot(x = Weekly[, 1:8], 
            y = Weekly$Direction,
            scales = list(x=list(relation="free"), 
                        y=list(relation="free")),
            plot = "density", pch = "|", 
            auto.key = list(columns = 2))

```

###Logistic Regression
```{r}

glm.fit <- glm(Direction ~ Lag1 + Lag2 + Lag3 + Lag4 + Lag5 + Volume, 
               data = Weekly, 
               family = binomial)

summary(glm.fit)
#Lag 2 is significant, in addition to the intercept

probs = predict(glm.fit, type = "response")
preds = rep("Down", 1089)
preds[probs > 0.5] = "Up"
table(preds, Weekly$Direction)
confusionMatrix(data = as.factor(preds), reference = Weekly$Direction, positive = "Down")

test.pred.prob  <- predict(glm.fit, newdata = Weekly, type = "response")
roc.glm <- roc(Weekly$Direction, test.pred.prob)
plot(roc.glm, legacy.axes = TRUE, print.auc = TRUE)
plot(smooth(roc.glm), col = 4, add = TRUE)

#AUC 0.554

```
```{r}
training.data = Weekly[Weekly$Year < 2009,]
test.data = Weekly[Weekly$Year > 2008,]
glm.fit2 = glm(Direction ~ Lag1 + Lag2, data = training.data, family = "binomial")
summary(glm.fit2)

test.pred.prob2 <- predict(glm.fit2, newdata = test.data, type = "response")
roc.glm2 <- roc(test.data$Direction, test.pred.prob2)
plot(roc.glm2, legacy.axes = TRUE, print.auc = TRUE)
plot(smooth(roc.glm2), col = 4, add = TRUE)

#AUC = 0.556
```
